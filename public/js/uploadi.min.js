(function(g){function l(a,b,c,d,h){this.template=e.getElementById(a);this.el=e.createElement("div");this.el.setAttribute("class","fum_file-upload-box");this.container=c;this.fileName=d;this.hiddenName=h+"[]";this.img=b}function f(a){var b=this;this.message=a;this.el=e.createElement("div");this.el.setAttribute("class","fum_error-box");this.template=e.getElementById("errorTemplate");this.el.innerHTML=this.template.innerHTML;this.messSpan=this.el.querySelector(".fum_message");this.closebtn=this.el.querySelector(".fum_close-btn");
    this.closebtn.addEventListener("click",function(){b.close()});return this}function m(a,b,c){this.req=new XMLHttpRequest;this.file=a;this.url=b;this.view=c}function n(a,b,c,d,h,e){var f=!!(g.File&&g.FileList&&g.FileReader),k=!!g.FormData;if(!((new XMLHttpRequest).upload&&f&&k))return this.supported=!1;this.supported=!0;this.select=a;this.container=c;this.url=b;this.templateId=d;this.hiddenName=h;this.imageOnly=e||!1;this.uploads=[];this.init()}function k(a,b,c,d,h,e){this.uploadView=new l(c,b,h,a.name,
    e);this.upload=new m(a,d,this.uploadView);this.init()}var e=g.document;l.prototype={init:function(){this.el.innerHTML=this.template.innerHTML;this.progressbar=this.el.querySelector(".fum_progressbar_inner");this.progressbarOuter=this.el.querySelector(".fum_progressbar_outer");this.cancelbtn=this.el.querySelector(".fum_cancelbtn");this.statusline=this.el.querySelector(".fum_status");this.fileNameSpan=this.el.querySelector(".fum_filename");this.attachEvents();this.render()},attachEvents:function(){},
    render:function(){this.img.src&&(this.el.querySelector(".fum_fileimg").src=this.img.src);this.fileNameSpan.innerHTML=50<this.fileName.length?this.fileName.substring(this.fileName.length-(this.fileName.length-50)):this.fileName;this.container.appendChild(this.el)},cancelOrRemove:function(){alert("boo")},setProgress:function(a){this.progressbar.style.width=a+"%"},setStatus:function(a){this.statusline.innerHTML=a},addHidden:function(a){this.hidden=e.createElement("input");this.hidden.setAttribute("type",
        "hidden");this.hidden.setAttribute("name",this.hiddenName);this.hidden.value=a;this.el.appendChild(this.hidden)},close:function(){this.el.parentNode.removeChild(this.el)}};f.prototype.render=function(a){this.messSpan.innerHTML=this.message;a.insertBefore(this.el,a.firstChild);return this};f.prototype.close=function(){this.el.parentNode.removeChild(this.el)};m.prototype={init:function(){function a(){c.stop();c.view.close()}function b(){c.view.close()}var c=this,d=new FormData;d.append("upload",this.file);
    d.append("_token",this.getCSRFToken());this.req.open("POST",this.url,!0);this.req.setRequestHeader("X-Requested-With","XMLHttpRequest");this.req.upload.addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100);c.view.setProgress(a)});this.req.onreadystatechange=function(d){4==c.req.readyState&&(c.view.setProgress(100),c.view.cancelbtn.removeEventListener("click",a,!1),c.view.cancelbtn.addEventListener("click",b,!1),c.view.cancelbtn.innerHTML="remove",200===c.req.status?(c.view.setStatus("complete"),
        c.view.addHidden(JSON.parse(d.target.response)),c.view.progressbarOuter.style.display="none"):(c.view.setStatus("failed"),console.log(d.target),c.view.progressbar.style.backgroundColor="#FF0000"))};this.req.send(d);this.view.cancelbtn.addEventListener("click",a,!1)},stop:function(){this.req.abort()},getCSRFToken:function(){var a=document.getElementsByTagName("meta"),b=0,c=a.length;for(b;b<c;b++)if("CSRF-token"==a[b].getAttribute("property"))return a[b].getAttribute("content");return""}};n.prototype=
{init:function(){var a=this;this.select.addEventListener("change",function(b){a.selectHandler(b)})},selectHandler:function(a){a=a.target.files;var b=0,c=a.length;for(b;b<c;b++)this.parseFile(a[b])},parseFile:function(a){if(5242880<a.size)(new f(a.name+" is just too large. The limit is 5MB.")).render(this.container);else{var b=this,c=new Image;if(0==a.type.indexOf("image")){var d=new FileReader;d.onload=function(d){c.src=d.target.result;d=new k(a,c,b.templateId,b.url,b.container,b.hiddenName);b.uploads.push(d)};
    d.readAsDataURL(a)}else this.imageOnly?(new f(a.name+" is not an image file.")).render(this.container):this.checkFile(a)?(d=new k(a,{},b.templateId,b.url,b.container,b.hiddenName),this.uploads.push(d)):(new f(a.name+" is not a valid file.")).render(this.container)}},checkFile:function(a){return{doc:1,docx:1,pdf:1,odt:1,txt:1}[a.name.split(".")[a.name.split(".").length-1]]?!0:!1}};k.prototype={init:function(){this.uploadView.init();this.upload.init()}};g.FileUploadManager=n;return!0})(window);